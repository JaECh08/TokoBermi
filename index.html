<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROGRAM TOKO BERMI</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="style_append.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <script src="xlsx.full.min.js"></script>
    <script src="jspdf.umd.min.js"></script>
</head>

<body>
    <!-- Login Screen -->
    <div id="login-screen" class="login-overlay">
        <div class="login-card">
            <img src="LOGO TOKO BERMI BULAT.png" alt="Logo" class="login-logo">
            <h2>Login Toko Bermi</h2>
            <p>Silakan masuk untuk mengelola data</p>
            <form id="login-form">
                <div class="form-group">
                    <label>Username (Email)</label>
                    <input type="email" id="login-email" placeholder="Masukkan email" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <div class="password-wrapper">
                        <input type="password" id="login-password" placeholder="Masukkan password" required>
                        <button type="button" id="toggle-password" class="toggle-password-btn"
                            onclick="togglePasswordVisibility()">
                            <span id="eye-icon">üëÅ</span>
                        </button>
                    </div>
                </div>
                <button type="submit" class="add-customer-button">Masuk ke Sistem</button>
            </form>
            <div id="login-error" class="error-message"></div>
        </div>
    </div>

    <div class="app-wrapper" id="main-app" style="display: none;">
        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
            <button class="toggle-sidebar-btn" onclick="toggleSidebar()" title="Toggle Sidebar">
                <span id="toggle-icon">‚ùÆ</span>
            </button>
            <div class="logo-container">
                <img src="LOGO TOKO BERMI BULAT.png" alt="Logo Toko Bermi" class="sidebar-logo">
                <h2 class="brand-name">Toko Bermi</h2>
            </div>
            <nav class="sidebar-nav">
                <button class="nav-item active" onclick="showScreen('home-screen')">
                    <span class="icon">üè†</span> <span class="nav-label">Dashboard</span>
                </button>
                <button class="nav-item" onclick="showScreen('create-invoice')">
                    <span class="icon">üìù</span> <span class="nav-label">Buat Nota</span>
                </button>
                <button class="nav-item" onclick="showScreen('stock-management')">
                    <span class="icon">üì¶</span> <span class="nav-label">Stok Barang</span>
                </button>
                <button class="nav-item" onclick="showScreen('customer-data')">
                    <span class="icon">üë•</span> <span class="nav-label">Data Pelanggan</span>
                </button>
                <button class="nav-item" onclick="showScreen('supplier-data')">
                    <span class="icon">üè≠</span> <span class="nav-label">Data Supplier</span>
                </button>
                <button class="nav-item" onclick="showScreen('print-invoice')">
                    <span class="icon">üñ®Ô∏è</span> <span class="nav-label">Print Nota</span>
                </button>
                <div style="flex-grow: 1;"></div>
                <button id="logout-btn" class="nav-item nav-logout" onclick="logout()">
                    <span class="icon">üö™</span> <span class="nav-label">Logout</span>
                </button>
            </nav>

        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="top-bar">
                <div class="welcome-text">Selamat Datang, <strong>Ferryanto</strong></div>
                <div class="header-right" style="display: flex; align-items: center; gap: 20px;">
                    <div class="date-display" id="current-date-display"></div>
                    <button class="theme-toggle-btn" onclick="toggleTheme()" title="Toggle Dark/Light Mode">
                        <span id="theme-icon">üåô</span>
                    </button>
                </div>
            </header>

            <div class="content-container">
                <!-- Home Screen / Dashboard -->
                <div id="home-screen" class="screen active fade-in">
                    <div class="dashboard-hero">
                        <h1>Selamat Datang di Aplikasi Toko Bermi</h1>
                        <p>Menjual Berbagai Macam Cetakan Kue dan Peralatan Masak</p>
                    </div>
                    <div class="dashboard-cards">
                        <div class="card stats-card" onclick="showProductsDetail()">
                            <div class="card-icon">üì¶</div>
                            <div class="stats-content">
                                <h3>Total Produk</h3>
                                <p class="stats-number" id="total-products">0</p>
                                <p class="stats-label">Jenis Barang Tersedia</p>
                            </div>
                        </div>
                        <div class="card stats-card" onclick="showCustomersDetail()">
                            <div class="card-icon">üë•</div>
                            <div class="stats-content">
                                <h3>Total Pelanggan</h3>
                                <p class="stats-number" id="total-customers">0</p>
                                <p class="stats-label">Pelanggan Terdaftar</p>
                            </div>
                        </div>
                        <div class="card stats-card" onclick="showTransactionsDetail()">
                            <div class="card-icon">üìä</div>
                            <div class="stats-content">
                                <h3>Total Transaksi</h3>
                                <p class="stats-number" id="total-transactions">0</p>
                                <p class="stats-label">Nota Tersimpan</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="create-invoice" class="screen">
                    <h2>Membuat Nota</h2>
                    <div class="form-group">
                        <label for="invoice-date">Tanggal:</label>
                        <input type="text" id="invoice-date" readonly>
                    </div>
                    <form id="invoice-form">
                        <h3>Data Pemesan</h3>
                        <div class="form-group">
                            <label for="customer-search-input">Nama Pelanggan:</label>
                            <div class="autocomplete-wrapper">
                                <input type="text" id="customer-search-input" name="customer-name"
                                    placeholder="Ketik nama pelanggan..." required autocomplete="off"
                                    class="customer-search-input">
                                <input type="hidden" id="customer-key">
                                <div class="custom-dropdown" id="customer-dropdown"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="customer-city">Kota:</label>
                            <input type="text" id="customer-city" name="customer-city">
                        </div>
                        <div class="form-group">
                            <label for="customer-phone">No. HP:</label>
                            <input type="text" id="customer-phone" name="customer-phone">
                        </div>
                        <div class="form-group">
                            <label for="expedition">Ekspedisi:</label>
                            <input type="text" id="expedition">
                        </div>

                        <h3 style="margin-top: 30px; margin-bottom: 15px;">Barang Pesanan</h3>
                        <div id="items-list">
                        </div>
                        <button type="button" class="row-btn btn-add" onclick="addItemRow()"
                            style="margin-top: 10px;">+</button>
                        <datalist id="stock-items-list"></datalist>
                        <div id="stock-error" class="error-message"></div>

                        <p id="total-amount">Total: Rp 0</p>
                        <div class="invoice-action-buttons">
                            <button type="button" class="finish-button" onclick="processInvoice()">Pesanan
                                Selesai</button>
                            <button type="button" class="clear-form-button" onclick="clearInvoiceForm()">Hapus
                                Semua</button>
                            <button type="button" id="cancel-edit-button" class="cancel-edit-button"
                                onclick="cancelEdit()" style="display: none;">Batalkan Edit</button>
                        </div>
                    </form>
                </div>

                <div id="stock-management" class="screen">
                    <h2>Stok Barang</h2>
                    <!-- Form Tambah Barang Baru -->
                    <div class="card add-item-card" style="margin-bottom: 30px;">
                        <h3 style="margin-bottom: 20px;">üì¶ Tambah Barang Baru</h3>
                        <form id="add-item-form" onsubmit="addItem(event)">
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                                <div class="form-group">
                                    <label for="new-item-name">Nama Barang:</label>
                                    <input type="text" id="new-item-name" required>
                                </div>
                                <div class="form-group">
                                    <label for="new-item-unit">Satuan:</label>
                                    <input type="text" id="new-item-unit" required>
                                </div>
                                <div class="form-group">
                                    <label for="new-item-supplier">Supplier:</label>
                                    <input type="text" id="new-item-supplier" required>
                                </div>
                                <div class="form-group">
                                    <label for="new-item-stock">Jumlah Stock:</label>
                                    <input type="number" id="new-item-stock" min="0" step="any" required>
                                </div>
                                <div class="form-group">
                                    <label for="new-item-min-order">Min Order:</label>
                                    <input type="text" id="new-item-min-order">
                                </div>
                                <div class="form-group">
                                    <label for="new-item-min-stock">Min Stock:</label>
                                    <input type="number" id="new-item-min-stock" min="0" step="any" required>
                                </div>
                                <div class="form-group">
                                    <label for="new-item-hpp">HPP:</label>
                                    <input type="number" id="new-item-hpp" min="0" step="any" required>
                                </div>
                                <div class="form-group">
                                    <label for="new-item-price">Harga Jual:</label>
                                    <input type="number" id="new-item-price" min="0" step="any" required>
                                </div>
                            </div>
                            <button type="submit" class="add-customer-button" style="margin-top: 10px;">+ Tambah Barang
                                Ke List</button>
                        </form>
                    </div>

                    <div class="stock-controls" style="margin-bottom: 15px;">
                        <div class="search-group">
                            <!-- Custom Dropdown Structure replacing <select> -->
                            <div class="custom-select-container" id="stock-search-container">
                                <div class="custom-select-trigger" onclick="toggleCustomSelect()">
                                    <span id="custom-select-value">Nama Barang</span>
                                    <span class="custom-arrow"></span>
                                </div>
                                <div class="custom-options" id="custom-options-list">
                                    <div class="custom-option selected" onclick="selectOption('name', 'Nama Barang')">
                                        Nama Barang</div>
                                    <div class="custom-option" onclick="selectOption('supplier', 'Supplier')">Supplier
                                    </div>
                                </div>
                                <input type="hidden" id="stock-search-mode" value="name">
                            </div>
                            <input type="text" id="stock-search-input" placeholder="Cari..."
                                oninput="renderStockTable()">
                        </div>
                        <button id="stock-sort-button" onclick="toggleStockSort()">Abjad A-Z</button>
                    </div>

                    <!-- Import Excel Section (Premium UI) -->
                    <div class="import-card" style="margin-bottom: 25px;">
                        <div class="import-label">
                            <span style="font-size: 1.5rem;">üìä</span>
                            <span>Update Stok:</span>
                        </div>
                        <div class="file-input-wrapper">
                            <input type="file" id="excel-input" accept=".xlsx, .xls" class="file-input-hidden"
                                onchange="updateFileName()">
                            <label for="excel-input" class="file-input-label">
                                <span class="icon">üìÅ</span> <span id="file-name-display">Pilih File Excel
                                    Anda...</span>
                            </label>
                        </div>
                        <button onclick="handleExcelUpload()" class="import-button">
                            <span>üöÄ</span> Proses Import
                        </button>
                    </div>



                    <table id="stock-table">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Nama Barang</th>
                                <th>Satuan</th>
                                <th>Supplier</th>
                                <th>Jumlah Stock</th>
                                <th>Minimum Order</th>
                                <th>Minimum Stock</th>
                                <th>HPP</th>
                                <th>Harga Jual</th>
                                <th>Keuntungan (%)</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                    <p class="note">Klik pada kolom Nama Barang, Satuan, Supplier, Jumlah Stock, Minimum Order, Minimum
                        Stock, HPP,
                        atau
                        Harga Jual untuk mengedit.
                    </p>

                    <div class="stock-footer-actions">
                        <button onclick="downloadStockExcel()" class="download-button">
                            <span>üì•</span> Download data (Excel)
                        </button>

                        <!-- Floating Back to Top Button -->
                        <button onclick="scrollToTop()" class="back-to-top-btn" id="backToTopBtn">
                            <span>‚Üë</span> Go Back
                        </button>
                    </div>

                </div>

                <div id="customer-data" class="screen">
                    <h2>Data Pelanggan</h2>
                    <form id="add-customer-form" onsubmit="addCustomer(event)">
                        <div class="form-group">
                            <label for="new-customer-name">Nama Pelanggan:</label>
                            <input type="text" id="new-customer-name" required>
                        </div>
                        <div class="form-group">
                            <label for="new-customer-city">Kota:</label>
                            <input type="text" id="new-customer-city" required>
                        </div>
                        <div class="form-group">
                            <label for="new-customer-phone">No. HP:</label>
                            <input type="text" id="new-customer-phone" required>
                        </div>
                        <div class="form-group">
                            <label for="new-customer-expedition">Ekspedisi:</label>
                            <input type="text" id="new-customer-expedition" required>
                        </div>
                        <div class="form-group">
                            <label for="new-customer-note">Catatan (Opsional):</label>
                            <input type="text" id="new-customer-note">
                        </div>
                        <button type="submit" class="add-customer-button">Tambah Pelanggan</button>
                    </form>

                    <div class="stock-controls" style="margin-top: 30px; margin-bottom: 20px;">
                        <div class="search-group">
                            <input type="text" id="customer-table-search-input" placeholder="Cari nama pelanggan..."
                                oninput="renderCustomerTable()">
                        </div>
                        <button id="customer-sort-button" onclick="toggleCustomerSort()">Abjad A-Z</button>
                    </div>

                    <table id="customer-table">
                        <thead>
                            <tr>
                                <th>Nama Pelanggan</th>
                                <th>Kota</th>
                                <th>No. HP</th>
                                <th>Ekspedisi</th>
                                <th>Catatan</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                    <p class="note">Klik pada kolom Nama Pelanggan, Kota, No. HP, Ekspedisi, atau Catatan untuk
                        mengedit.</p>
                </div>

                <div id="supplier-data" class="screen">
                    <h2>Data Supplier</h2>
                    <form id="add-supplier-form" onsubmit="addSupplier(event)">
                        <div class="form-group">
                            <label for="new-supplier-name">Nama Supplier:</label>
                            <input type="text" id="new-supplier-name" required>
                        </div>
                        <div class="form-group">
                            <label for="new-supplier-phone">No. HP:</label>
                            <input type="text" id="new-supplier-phone" required>
                        </div>
                        <div class="form-group">
                            <label for="new-supplier-address">Alamat:</label>
                            <input type="text" id="new-supplier-address" required>
                        </div>
                        <div class="form-group">
                            <label for="new-supplier-note">Catatan (Opsional):</label>
                            <input type="text" id="new-supplier-note">
                        </div>
                        <button type="submit" class="add-customer-button">Tambah Supplier</button>
                    </form>

                    <div class="stock-controls" style="margin-top: 30px; margin-bottom: 20px;">
                        <div class="search-group">
                            <input type="text" id="supplier-search-input" placeholder="Cari nama supplier..."
                                oninput="renderSupplierTable()">
                        </div>
                        <button id="supplier-sort-button" onclick="toggleSupplierSort()">Abjad A-Z</button>
                    </div>

                    <table id="supplier-table">
                        <thead>
                            <tr>
                                <th>Nama Supplier</th>
                                <th>No. HP</th>
                                <th>Alamat</th>
                                <th>Catatan</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                    <p class="note">Klik pada kolom Nama Supplier, No. HP, Alamat, atau Catatan untuk mengedit.</p>
                </div>

                <div id="print-invoice" class="screen">
                    <h2>Print Nota</h2>
                    <div class="sort-buttons">
                        <button class="sort-button" id="sort-toggle" onclick="toggleSort()">Urutkan: Terbaru</button>
                    </div>
                    <div id="invoices-list">
                    </div>
                </div> <!-- Close Screen print-invoice -->

                <!-- FOOTER -->
                <footer class="app-footer">
                    <div class="footer-left">
                        <img src="LOGO TOKO BERMI PANJANG.png" alt="Logo Toko Bermi" class="footer-logo">
                    </div>
                    <div class="footer-right">
                        <div class="footer-contact-item">
                            <span class="footer-icon">üìû</span>
                            <span class="footer-text">08113005532</span>
                        </div>

                        <div class="footer-contact-item">
                            <span class="footer-icon">üìç</span>
                            <span class="footer-text">Perumahan Vila Valensia<br>PA-4/1A, Surabaya</span>
                        </div>


                        <div class="footer-contact-item">
                            <span class="footer-icon">üì∏</span>
                            <span class="footer-text">@toko_bermi</span>
                        </div>


                    </div>
                </footer>
            </div> <!-- Close content-container -->

        </main> <!-- Close main-content -->
    </div> <!-- Close app-wrapper -->

    <div id="alert-modal" class="modal">
        <div class="modal-content">
            <div class="modal-body">
                <p id="modal-message"></p>
            </div>
            <button class="close-button" onclick="closeModal()">X</button>
        </div>
    </div>

    <div id="confirm-modal" class="modal">
        <div class="modal-content confirm-card">
            <div class="modal-body">
                <h3 id="confirm-title" style="margin-bottom: 15px; color: var(--text-primary);">Konfirmasi</h3>
                <p id="confirm-message" style="margin-bottom: 25px; color: var(--text-secondary);"></p>
                <div class="confirm-buttons">
                    <button id="confirm-yes" class="btn-confirm btn-primary">Ya, Keluar</button>
                    <button id="confirm-no" class="btn-confirm btn-secondary"
                        onclick="closeConfirmModal()">Batal</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Detail Modal for Statistics -->
    <div id="detail-modal" class="modal">
        <div class="modal-content detail-modal-content">
            <div class="detail-modal-header">
                <h2 id="detail-modal-title">Detail Informasi</h2>
                <button class="detail-close-btn" onclick="closeDetailModal()">√ó</button>
            </div>
            <div class="detail-modal-body" id="detail-modal-body">
                <!-- Content will be dynamically inserted here -->
            </div>
        </div>
    </div>



    <!-- Firebase SDK (Compat Version for file:// support) -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

    <!-- Main Application Script -->
    <script src="script.js"></script>
    <script src="theme.js"></script>
    <script src="detail_modal_functions.js"></script>
</body>

</html>
